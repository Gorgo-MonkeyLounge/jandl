<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Publication</title>
		
		<!-- 1. KEEP YOUR ORIGINAL STYLES -->
		<link href="publication-web-resources/css/main.css" rel="stylesheet" type="text/css">
		<script src="publication-web-resources/script/main.js" type="text/javascript"></script>

		<!-- 2. NEW STYLES TO FIX LAYOUT & HIDE GHOST RECTANGLE -->
		<style>
			body, html {
				margin: 0;
				padding: 0;
				width: 100%;
				height: 100%;
				background-color: #fafafa; /* Light Grey Background */
				overflow: hidden; 
			}

			/* Fix the Main Iframe */
			#contentIFrame {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				border: none;
				z-index: 1; /* Below the arrows */
			}

			/* CRITICAL FIX: Hide the Dummy Iframe (The small rectangle) */
			#dummyIFrame {
				position: absolute;
				top: -9999px;
				left: -9999px;
				width: 1px;
				height: 1px;
				opacity: 0;
				visibility: hidden;
				border: none;
				display: none !important;
			}

			/* Ensure Arrows are on top */
			.prev, .next {
				z-index: 9999;
			}
		</style>

		<!-- 3. SCRIPT TO CENTER PAGES AND FIX VIDEO -->
		<script>
			// This function runs every time a new page loads in the iframe
			function applyCustomFixes() {
				var iframe = document.getElementById("contentIFrame");
				
				// Wait slightly to ensure InDesign content is ready
				setTimeout(function() {
					try {
						var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
						
						// --- A. CENTER THE PAGE ---
						// We look for the first main div inside the iframe body
						var mainDiv = innerDoc.querySelector('body > div');
						
						if (mainDiv) {
							// Get the width/height InDesign set for the page
							var w = parseFloat(mainDiv.style.width) || mainDiv.offsetWidth || 595;
							var h = parseFloat(mainDiv.style.height) || mainDiv.offsetHeight || 842;
							
							var halfW = w / 2;
							var halfH = h / 2;

							// Inject CSS into the iframe to center that specific div
							var style = innerDoc.createElement('style');
							style.innerHTML = `
								body { 
									background-color: transparent !important; 
									overflow: hidden !important; 
									margin: 0 !important;
									height: 100vh !important;
									width: 100vw !important;
								}
								/* Center the container using absolute positioning + negative margins */
								body > div:first-child {
									position: absolute !important;
									left: 50% !important;
									top: 50% !important;
									margin-left: -${halfW}px !important;
									margin-top: -${halfH}px !important;
									box-shadow: 0 0 30px rgba(0,0,0,0.1); 
									transform-origin: center center !important;
								}
								
								/* VIDEO POPUP STYLES */
								#videoModalOverlay {
									position: fixed; top: 0; left: 0; width: 100%; height: 100%;
									background: rgba(0,0,0,0.85); z-index: 10000;
									display: flex; justify-content: center; align-items: center;
									opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
								}
								#videoModalOverlay.active { opacity: 1; pointer-events: all; }
								.modal-content { position: relative; width: 80%; max-width: 900px; }
								.modal-content video { width: 100%; box-shadow: 0 0 20px #000; border-radius: 8px; }
								.close-btn {
									position: absolute; top: -40px; right: 0;
									color: white; font-size: 24px; cursor: pointer; font-family: sans-serif;
									background: rgba(0,0,0,0.5); border: 1px solid white; padding: 5px 15px; border-radius: 4px;
								}
							`;
							innerDoc.head.appendChild(style);
						}

						// --- B. VIDEO POPUP LOGIC ---
						var originalVideo = innerDoc.querySelector('video');
						if (originalVideo) {
							var videoSrc = originalVideo.querySelector('source') ? originalVideo.querySelector('source').src : originalVideo.src;
							var videoContainer = originalVideo.parentNode;

							// Hide original video, keep the poster image visible
							originalVideo.style.display = 'none';
							videoContainer.style.cursor = 'pointer';
							videoContainer.setAttribute('title', 'Play Video');

							// Create Modal
							var modalDiv = innerDoc.createElement('div');
							modalDiv.innerHTML = `
								<div id="videoModalOverlay">
									<div class="modal-content">
										<button class="close-btn" id="btnCloseVid">CLOSE X</button>
										<video id="popupVideo" controls>
											<source src="${videoSrc}" type="video/mp4">
										</video>
									</div>
								</div>
							`;
							innerDoc.body.appendChild(modalDiv);

							// Click handlers
							videoContainer.onclick = function() {
								var overlay = innerDoc.getElementById('videoModalOverlay');
								var popupVid = innerDoc.getElementById('popupVideo');
								overlay.classList.add('active');
								popupVid.currentTime = 0;
								popupVid.play();
							};

							innerDoc.getElementById('btnCloseVid').onclick = function() {
								var overlay = innerDoc.getElementById('videoModalOverlay');
								var popupVid = innerDoc.getElementById('popupVideo');
								overlay.classList.remove('active');
								popupVid.pause();
							};
						}

					} catch(e) {
						console.log("Waiting for content...");
					}
				}, 200); // 200ms delay to make sure InDesign elements exist
			}
		</script>
	</head>
	
	<!-- 4. ONLOAD EVENT: Load Arrows AND Apply Fixes -->
	<body onload="showHideArrows(); applyCustomFixes();">
		
		<!-- Added applyCustomFixes() here too, so it runs when you click Next/Prev -->
		<iframe onload="showHideArrows(); applyCustomFixes();" id="contentIFrame" class="contentIframeClass" src="publication-web-resources/html/publication.html"></iframe>
		
		<!-- Added inline styles to force hide this frame -->
		<iframe id="dummyIFrame" class="dummyFrameClass" style="display:none; visibility:hidden; width:0; height:0;"></iframe>
		
		<div class="prev" onclick="showPreviousPage()">&#10094;</div>
		<div class="next" onclick="showNextPage()">&#10095;</div>
	</body>
</html>

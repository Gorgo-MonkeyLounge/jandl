<!DOCTYPE html>
<html>
	<head>
		<link href="publication-web-resources/css/main.css" rel="stylesheet" type="text/css">
		<script src="publication-web-resources/script/main.js" type="text/javascript"></script>
        
        <style>
            /* 1. PARENT PAGE STYLING */
            body, html {
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
                background-color: #f7f7f7; /* Very light grey */
                display: flex;            /* Enables centering */
                justify-content: center;  /* Center horizontally */
                align-items: center;      /* Center vertically */
                overflow: hidden; 
            }

            /* 2. OVERRIDE main.css for the iframe */
            #contentIFrame {
                position: relative !important; /* Change from absolute to allow flex centering */
                box-shadow: 0 0 40px rgba(0,0,0,0.15);
                background-color: white;
                border: none;
                /* Initial sizes (JS will refine these) */
                width: 595px; 
                height: 878px;
                max-width: 95vw;
                max-height: 95vh;
            }

            /* Ensure arrows stay on top of everything */
            .prev, .next { z-index: 100; }
        </style>

        <script>
            function fixLayoutAndVideo() {
                var iframe = document.getElementById("contentIFrame");
                var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // --- STEP 1: RESIZE IFRAME TO MATCH CONTENT ---
                // We find that div you found earlier
                var mainDiv = innerDoc.querySelector('body > div');
                if (mainDiv) {
                    var contentW = mainDiv.style.width || "595px";
                    var contentH = mainDiv.style.height || "878px";
                    
                    // Apply the internal page size to the iframe itself
                    iframe.style.width = contentW;
                    iframe.style.height = contentH;
                }

                // --- STEP 2: VIDEO POPUP LOGIC ---
                var originalVideo = innerDoc.querySelector('video');
                if (originalVideo) {
                    var videoSrc = originalVideo.querySelector('source') ? originalVideo.querySelector('source').src : originalVideo.src;
                    var videoContainer = originalVideo.parentNode;

                    // Hide original video
                    originalVideo.style.display = 'none';
                    videoContainer.style.cursor = 'pointer';

                    // Inject Modal CSS into iframe
                    var style = innerDoc.createElement('style');
                    style.innerHTML = `
                        #videoModal {
                            position: fixed; top:0; left:0; width:100%; height:100%;
                            background: rgba(0,0,0,0.9); z-index:9999;
                            display:none; justify-content:center; align-items:center;
                        }
                        #videoModal.open { display:flex; }
                        .close-vid { position:absolute; top:20px; right:20px; color:white; cursor:pointer; font-size:24px; font-family:sans-serif; }
                        video#popupVid { width: 90%; max-height: 80%; border: 2px solid #444; }
                    `;
                    innerDoc.head.appendChild(style);

                    // Inject Modal HTML
                    var modalDiv = innerDoc.createElement('div');
                    modalDiv.id = "videoModal";
                    modalDiv.innerHTML = `
                        <div class="close-vid" onclick="document.getElementById('videoModal').classList.remove('open'); document.getElementById('popupVid').pause();">âœ• CLOSE</div>
                        <video id="popupVid" controls src="${videoSrc}"></video>
                    `;
                    innerDoc.body.appendChild(modalDiv);

                    // Open Trigger
                    videoContainer.onclick = function() {
                        innerDoc.getElementById('videoModal').classList.add('open');
                        innerDoc.getElementById('popupVid').play();
                    };
                }
            }
        </script>
	</head>
    
	<body onload="showHideArrows()">
        <!-- We use the iframe onload to trigger our fixes -->
		<iframe onload="showHideArrows(); setTimeout(fixLayoutAndVideo, 300);" id="contentIFrame" class="contentIframeClass" src="publication-web-resources/html/publication.html"></iframe>
		
        <iframe id="dummyIFrame" class="dummyFrameClass"></iframe>
        
        <!-- Navigation Arrows -->
		<div class="prev" onclick="showPreviousPage()">&#10094;</div>
		<div class="next" onclick="showNextPage()">&#10095;</div>
	</body>
</html>
